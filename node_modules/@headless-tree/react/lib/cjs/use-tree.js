"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useTree = void 0;
const react_1 = require("react");
const core_1 = require("@headless-tree/core");
const useTree = (config) => {
    const [tree] = (0, react_1.useState)(() => ({ current: (0, core_1.createTree)(config) }));
    const [state, setState] = (0, react_1.useState)(() => tree.current.getState());
    (0, react_1.useEffect)(() => {
        tree.current.rebuildTree();
    }, [tree]); // runs only once after mount
    (0, react_1.useInsertionEffect)(() => {
        tree.current.setConfig((prev) => (Object.assign(Object.assign(Object.assign({}, prev), config), { state: Object.assign(Object.assign({}, state), config.state), setState: (state) => {
                var _a;
                setState(state);
                (_a = config.setState) === null || _a === void 0 ? void 0 : _a.call(config, state);
            } })));
    });
    return tree.current;
};
exports.useTree = useTree;
